<!DOCTYPE html>
<html>
    <head>
        <title>WebSocket demo</title>
    </head>
    <!-- <body onload="test()"> -->
    <body>
        <form id="myForm" onsubmit="myFunction(event)">
            <label for="fname">First name:</label><br>
            <input type="text" name="fname" value="John"><br><br>
            <input type="submit" value="Submit">
        </form>

        <script>
            // function test() {
            //      // open websocket
            //      var socket = new WebSocket('ws://127.0.0.1:5678'),
            //         messages = document.createElement('ul');

            //      socket.onopen = function() {
            //          console.log("onopen!");
            //          // Web Socket is connected. send an initial random message.
            //          socket.send("Hello!");
            //      };
            //      socket.onmessage = function() {
            //         var messages = document.getElementsByTagName('ul')[0],
            //             message = document.createElement('li'),
            //             content = document.createTextNode(event.data);
            //         message.appendChild(content);
            //         messages.appendChild(message); 
            //      };
            //      document.body.appendChild(messages);
            // }

            function myFunction() {
                event.preventDefault();
                var inputs = document.getElementById("myForm").elements;
                var inputByName = inputs["fname"];
                
                var ws = new WebSocket("ws://127.0.0.1:5678/"),
                    messages = document.createElement('ul');

                ws.onopen = function(event) {
                    console.log("WebSocket is open now.");
                    ws.send(inputByName.value);
                };
                // create ready state to prevent multiple websocket connections
                ws.onmessage = function(event) {
                    data = JSON.parse(event.data);

                    var messages = document.getElementsByTagName('ul')[0],
                        message = document.createElement('li'),
                        content = document.createTextNode(event.data.slice(1, -1));

                    console.log(data);
                    console.log(event);
                    console.log(event.data);
                    message.appendChild(content);
                    messages.appendChild(message); 
                };

                document.body.appendChild(messages);
            }
            
        </script>

    </body>
</html>
