<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <title>WebSocket demo</title>
    </head>
    <!-- <body onload="test()"> -->
    <body >
        <!--<form id="myForm" onsubmit="myFunction(event)">-->
        <div class="container-fluid">
            <div class="row">
                <div class="col-xl">
            <form id="myForm">
                <label for="fname">First name:</label><br>
                <textarea id="fname" rows="4" cols="50" form="myForm" type="text" name="fname" value="John"></textarea><br><br>
                <button type="submit">Button</button>
            </form>
            <ul id="ulist"></ul>
                </div>
            </div>
        </div>
        <script>
            window.onload = function() {
            //function test() {
              console.log("JUST LOADED"); 
              // Get references to elements on the page.
              var actualForm = document.getElementById('myForm');
              var form = document.getElementById('myForm').elements;
              var messageField = form["fname"];
              var messageList = document.getElementById('ulist');
              var messages = document.getElementsByTagName('ul')[0];
              console.log(messageField.value); 
            
              // Create a new WebSocket.
              var socket = new WebSocket('ws://ec2-52-0-207-17.compute-1.amazonaws.com:5678/');
                                //messages = document.createElement('ul');
            
            
              // Handle any errors that occur.
              socket.onerror = function(error) {
                console.log('WebSocket Error: ' + error);
              };
            
            
              // Show a connected message when the WebSocket is opened.
              socket.onopen = function(event) {
                console.log("HERE");
                //socketStatus.innerHTML = 'Connected to: ' + event.currentTarget.url;
                //socketStatus.className = 'open';
              };
            
            
              // Handle messages sent by the server.
              socket.onmessage = function(event) {
                //stuff = JSON.parse(event.data);
                var stuff = event.data;
                console.log(stuff);
                var messages = document.getElementsByTagName('ul')[0],
                        message = document.createElement('li'),
                        //content = document.createTextNode(stuff.slice(0,-1));
                        content = document.createTextNode(stuff);
                        console.log(stuff);
                        //content = document.createTextNode(event.data.slice(1, -1));
                //messagesList.innerHTML += '<li class="sent"><span>Sent:</span>' + message + '</li>';
            
                // Clear out the message field.
                message.appendChild(content);
                messages.appendChild(message);
                //messagesList.innerHTML += '<li class="received"><span>Received:</span>' + message + '</li>';
              };
            
              //document.body.appendChild(messages); 
            
              // Show a disconnected message when the WebSocket is closed.
              socket.onclose = function(event) {
                socketStatus.innerHTML = 'Disconnected from WebSocket.';
                socketStatus.className = 'closed';
              };
            
            
              // Send a message when the form is submitted.
              actualForm.onsubmit = function(e) {
                e.preventDefault();
            
                // Retrieve the message from the textarea.
                var stuff = messageField.value;
                console.log(stuff);
            
                // Send the message through the WebSocket.
                socket.send(stuff);
                console.log("Submitted");
            
                // Add the message to the messages list.
                var messages = document.getElementsByTagName('ul')[0],
                        message = document.createElement('li'),
                        content = document.createTextNode(stuff);
                        //content = document.createTextNode(event.data.slice(1, -1));
                //messagesList.innerHTML += '<li class="sent"><span>Sent:</span>' + message + '</li>';
            
                // Clear out the message field.
                //message.appendChild(content);
                //messages.appendChild(message);
                //document.body.appendChild(messages); 
                messageField.value = '';
            
                return false;
                //socket.onmessage(e);
              };

              console.log("ARE WE GETTING HERE?");
              document.body.appendChild(messages); 
            
              // Close the WebSocket connection when the close button is clicked.
              //closeBtn.onclick = function(e) {
              //  e.preventDefault();
            
              //  // Close the WebSocket.
              //  socket.close();
            
              //  return false;
              //};
            
            };
            
        </script>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    </body>
</html>
