<!DOCTYPE html>
<html>
    <head>
        <title>WebSocket demo</title>
    </head>
    <!-- <body onload="test()"> -->
    <body onload="test()">
        <!--<form id="myForm" onsubmit="myFunction(event)">-->
        <form id="myForm">
            <label for="fname">First name:</label><br>
            <input id="fname" type="text" name="fname" value="John"><br><br>
        </form>
        <button onclick="myFunction(event)">Button</button>
        <script>

            var ws;

            function test() {
                 // open websocket
                ws = new WebSocket("ws://127.0.0.1:5678/");

                console.log(ws);
            }

            // function test() {
            //      // open websocket
            //      var socket = new WebSocket('ws://127.0.0.1:5678'),
            //         messages = document.createElement('ul');

            //      socket.onopen = function() {
            //          console.log("onopen!");
            //          // Web Socket is connected. send an initial random message.
            //          socket.send("Hello!");
            //      };
            //      socket.onmessage = function() {
            //         var messages = document.getElementsByTagName('ul')[0],
            //             message = document.createElement('li'),
            //             content = document.createTextNode(event.data);
            //         message.appendChild(content);
            //         messages.appendChild(message); 
            //      };
            //      document.body.appendChild(messages);
            // }

            function myFunction() {
                //event.preventDefault();
                var inputs = document.getElementById("myForm").elements;
                var inputByName = inputs["fname"];
                
                //var ws = new WebSocket("ws://127.0.0.1:5678/");
                var socket = new WebSocket("ws://127.0.0.1:5678/");
                //var socket = ws;
                console.log(socket);
                var messages = document.createElement('ul');

                socket.onopen = function(event) {
                    console.log("WebSocket is open now.");
                    socket.send(inputByName.value);
                };
                // create ready state to prevent multiple websocket connections
                socket.onmessage = function(event) {
                    data = JSON.parse(event.data);

                    var messages = document.getElementsByTagName('ul')[0],
                        message = document.createElement('li'),
                        content = document.createTextNode(event.data.slice(1, -1));

                    console.log(data);
                    console.log(event);
                    console.log(event.data);
                    message.appendChild(content);
                    messages.appendChild(message); 
                };


                document.body.appendChild(messages);
            }
            
        </script>

    </body>
</html>
